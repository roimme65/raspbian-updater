# Release v1.0.6 - Bugfix Release

**Release Date:** 27. Oktober 2025

## ğŸ› Behobene Fehler

### Cronjob-Installation funktioniert zuverlÃ¤ssig

Die Cronjob-Installation hatte Probleme mit der Pipe-Konstruktion, die zu leeren Crontabs fÃ¼hrte:

**Problem:**
- `(crontab -l | grep -v ...; echo ...) | crontab -` funktionierte nicht zuverlÃ¤ssig
- Cronjobs wurden nicht in die Root-Crontab geschrieben
- Keine Fehlermeldungen bei Problemen

**LÃ¶sung:**
- âœ… Verwendung von temporÃ¤rer Datei `/tmp/raspbian_cron_$$` statt Pipe
- âœ… `|| true` bei grep verhindert Exit-Code-Fehler bei leerer Crontab
- âœ… PrÃ¼fung ob Datei Inhalt hat vor crontab-Anwendung (`[ -s "$TEMP_CRON" ]`)
- âœ… Angewendet auf beide Cronjob-Optionen (einzeln und dual)
- âœ… Getestet: VollstÃ¤ndiger Install/Uninstall-Zyklus erfolgreich

**Betroffene Dateien:**
- `install.sh` (Zeilen 186-208, 159-177)

---

### Desktop-Benachrichtigungen in Cronjobs

Desktop-Benachrichtigungen funktionierten nicht, wenn das Skript Ã¼ber Cronjobs ausgefÃ¼hrt wurde:

**Problem:**
- Cron-Umgebung hat keine `DISPLAY` und `DBUS_SESSION_BUS_ADDRESS` Variablen
- notify-send konnte keine Verbindung zum Display herstellen
- Benachrichtigungen blieben aus bei automatischen Updates

**LÃ¶sung - 3-Stufen-Erkennung:**

**Methode 1: GUI-Prozess-Suche**
```python
# Sucht nach laufenden GUI-Sessions
- gnome-session
- lxsession  
- wayfire
- xfce4-session
- kde
- mate-session
# Extrahiert DISPLAY und DBUS direkt aus /proc/[pid]/environ
```

**Methode 2: DBUS-Socket-Pfade**
```python
# PrÃ¼ft Standard-Socket-Verzeichnisse
- /run/user/{uid}/bus
- /var/run/user/{uid}/dbus/user_bus_socket
```

**Methode 3: X11-Socket-Erkennung**
```python
# Fallback zu X11-Sockets
- /tmp/.X11-unix/X0, X1, X2, ...
```

**ZusÃ¤tzliche Verbesserungen:**
- âœ… XAUTHORITY Umgebungsvariable fÃ¼r X-Authentifizierung
- âœ… PrÃ¼fung ob X-Server existiert vor Benachrichtigungs-Versuch
- âœ… Debug-Logging bei FehlschlÃ¤gen
- âœ… Funktioniert zuverlÃ¤ssig in Cron-Umgebungen

**Betroffene Dateien:**
- `raspbian_autoupdater.py` (Zeilen 405-540)

---

## ğŸ¨ Verbesserte Ausgabe

### Konsistente Formatierung der Update-Zusammenfassung

**Vorher:**
```
2025-10-27 10:01:21  âœ“ Keine Pakete wurden aktualisiert
2025-10-27 10:01:21  
âœ“ Kein Neustart erforderlich.
2025-10-27 10:01:21  
Log-Datei: /var/log/raspbian-updater/update_20251027_100110.log
```

**Nachher:**
```
2025-10-27 10:03:27  âœ“ Keine Pakete wurden aktualisiert (System ist auf dem neuesten Stand)

2025-10-27 10:03:27  âœ“ Kein Neustart erforderlich.

2025-10-27 10:03:27  Log-Datei: /var/log/raspbian-updater/update_20251027_100316.log
```

**Ã„nderungen:**
- âœ… Konsistente Timestamps auf allen Status-Zeilen
- âœ… Leerzeilen ohne Timestamps (bessere Lesbarkeit)
- âœ… Saubere Trennung zwischen Zusammenfassungs-Abschnitten
- âœ… Verwendung von `print()` fÃ¼r Leerzeilen statt `\n` in `print_status()`

**Betroffene Dateien:**
- `raspbian_autoupdater.py` (Zeilen 657-659, 689-690)

---

### Vereinfachtes uninstall.sh Banner

**Vorher:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Raspbian Auto-Updater - Deinstallation            â•‘
â•‘   Version 1.0.4                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Nachher:**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Raspbian Auto-Updater - Deinstallation            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Grund:** Versionsnummer im Uninstall-Script war verwirrend und wurde oft nicht aktualisiert.

**Betroffene Dateien:**
- `uninstall.sh` (Zeile 17)

---

## ğŸ§ª Tests

Alle Fixes wurden getestet mit:

1. **Cronjob-Test:**
   ```bash
   sudo ./uninstall.sh  # Bereinigung
   sudo ./install.sh    # Installation mit Cronjob-Option 1
   sudo crontab -l      # Verifikation
   ```
   âœ… Cronjob erfolgreich in Root-Crontab erstellt

2. **Desktop-Benachrichtigung-Test:**
   ```bash
   sudo raspbian-autoupdater --dry-run  # Manueller Test
   # Warten auf Cronjob-AusfÃ¼hrung um 3:00 Uhr
   ```
   âœ… Benachrichtigungen erscheinen auch bei Cron-AusfÃ¼hrung

3. **Ausgabe-Test:**
   ```bash
   sudo raspbian-autoupdater
   ```
   âœ… Saubere, konsistente Formatierung in Update-Zusammenfassung

---

## ğŸ“¦ Installation

```bash
git clone https://github.com/roimme65/raspbian-updater.git
cd raspbian-updater
git checkout v1.0.6
sudo ./install.sh
```

Oder Update von vorheriger Version:

```bash
cd raspbian-updater
git pull
git checkout v1.0.6
sudo ./install.sh  # Aktualisiert Installation
```

---

## ğŸ“ GeÃ¤nderte Dateien

- `install.sh` - Cronjob-Installation mit temporÃ¤rer Datei
- `raspbian_autoupdater.py` - Desktop-Benachrichtigungen + Ausgabe-Formatierung
- `uninstall.sh` - Banner ohne Versionsnummer
- `README.md` - Version Badge auf 1.0.6
- `CHANGELOG.md` - Release-Notizen fÃ¼r v1.0.6

---

## ğŸ”— Links

- **Full Changelog:** https://github.com/roimme65/raspbian-updater/blob/main/CHANGELOG.md#106---2025-10-27
- **Commits:** https://github.com/roimme65/raspbian-updater/compare/v1.0.5...v1.0.6

---

## ğŸ“Š Statistiken

- **3 Dateien** geÃ¤ndert
- **154 Zeilen** hinzugefÃ¼gt/geÃ¤ndert
- **2 kritische Bugs** behoben
- **3 Verbesserungen** implementiert

---

**Download:** [v1.0.6.tar.gz](https://github.com/roimme65/raspbian-updater/archive/refs/tags/v1.0.6.tar.gz) | [v1.0.6.zip](https://github.com/roimme65/raspbian-updater/archive/refs/tags/v1.0.6.zip)
