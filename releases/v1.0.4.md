# Release v1.0.4 - Desktop-Benachrichtigungen

**VerÃ¶ffentlichungsdatum:** 25. Oktober 2025

## ğŸ”” Neue Features: Desktop-Benachrichtigungen

Diese Version fÃ¼gt umfassende Desktop-Benachrichtigungen hinzu, sodass Sie Ã¼ber System-Updates informiert werden - auch wenn diese im Hintergrund via Cronjob laufen.

### Desktop-Benachrichtigungen

**Drei Benachrichtigungstypen:**

#### ğŸ”´ Neustart erforderlich (urgency: critical)
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¢ Raspbian Auto-Updater - Neustart erforderlich
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

System-Update abgeschlossen!
6 Paket(e) wurden aktualisiert.

âš ï¸ Ein Neustart ist erforderlich.
Bitte starten Sie das System neu.
```
- **Icon:** Rotes Warnungs-Symbol
- **Dauer:** Persistent (bleibt sichtbar)
- **Sound:** Warnsignal
- **Use Case:** Kernel-Updates, systemd-Updates

#### ğŸŸ¢ Update erfolgreich (urgency: normal)
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¢ Raspbian Auto-Updater
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

System-Update erfolgreich abgeschlossen!
23 Paket(e) wurden aktualisiert.

âœ“ Kein Neustart erforderlich.
```
- **Icon:** GrÃ¼nes Update-Symbol
- **Dauer:** ~10 Sekunden
- **Sound:** Optional
- **Use Case:** Standard-Updates ohne Neustart

#### ğŸ”µ Keine Updates (urgency: low)
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¢ Raspbian Auto-Updater
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

System-Update abgeschlossen.

âœ“ System ist bereits auf dem neuesten Stand.
âœ“ Keine Updates verfÃ¼gbar.
```
- **Icon:** Info-Symbol
- **Dauer:** ~5 Sekunden
- **Sound:** Kein
- **Use Case:** RegelmÃ¤ÃŸige Cronjob-Checks ohne Updates

### Technische Details

**Funktionsweise:**

1. **Automatische User-Erkennung**
   - Nutzt `SUDO_USER` wenn mit sudo ausgefÃ¼hrt
   - Findet DISPLAY und DBUS automatisch aus `/proc/*/environ`
   - Fallback zu Standard-Werten (:0 und /run/user/UID/bus)

2. **Cronjob-kompatibel**
   - Funktioniert auch wenn als root via Cron ausgefÃ¼hrt
   - Benachrichtigt alle aktiven GUI-Sessions
   - Keine Terminal-Interaktion erforderlich

3. **Robuste Fehlerbehandlung**
   - Script lÃ¤uft normal weiter wenn notify-send fehlt
   - Keine Fehlermeldungen bei fehlender GUI
   - Stille Fehlerbehandlung fÃ¼r maximale StabilitÃ¤t

**Voraussetzungen (werden automatisch installiert):**
```bash
# Von install.sh automatisch installiert:
- libnotify-bin      # notify-send Kommando
- notification-daemon # Desktop-Notification-Service
```

## ğŸ› Bug-Fixes

### Seitlicher Versatz in apt-Ausgabe vollstÃ¤ndig behoben

**Problem:** Die Fortschrittsanzeigen von apt und dpkg erzeugten seitlich versetzte Ausgaben wie:
```
(Lese Datenbank ... 5%
                         (Lese Datenbank ... 10%
                                                  (Lese Datenbank ... 15%
```

**LÃ¶sung:**
1. **apt -q Option:** UnterdrÃ¼ckt apt-eigene Fortschrittsanzeige
2. **DEBIAN_FRONTEND=noninteractive:** Deaktiviert interaktive Dialoge
3. **-o Dpkg::Use-Pty=0:** UnterdrÃ¼ckt dpkg-Fortschrittsbalken

**Ergebnis:** Saubere, lineare Ausgabe ohne Versatz:
```
Holen:1 http://deb.debian.org/debian trixie InRelease [198 kB]
Holen:2 http://deb.debian.org/debian trixie/main arm64 Packages [9.2 MB]
Es wurden 9.4 MB in 3s geholt (3.1 MB/s)
```

## ğŸ“ Verbesserte Dokumentation

### README.md
- â• Neuer Abschnitt "Desktop-Benachrichtigungen"
- ğŸ“‹ Beispiele fÃ¼r alle drei Benachrichtigungstypen
- ğŸ”§ ErklÃ¤rung der technischen Funktionsweise

### install.sh
- ğŸ“¦ Automatische Installation von libnotify-bin
- ğŸ“¦ Automatische Installation von notification-daemon
- â„¹ï¸ Hinweis fÃ¼r Benutzer Ã¼ber GUI-FunktionalitÃ¤t

## ğŸ”§ Technische Ã„nderungen

### GeÃ¤nderte Dateien
- `raspbian_autoupdater.py`:
  - Neue Methode `send_desktop_notification()`
  - DEBIAN_FRONTEND=noninteractive fÃ¼r subprocess
  - apt-get mit -q und -o Dpkg::Use-Pty=0 Optionen
  - Benachrichtigungen nach Update-Zusammenfassung

- `install.sh`:
  - Installation von libnotify-bin
  - Installation von notification-daemon
  - **notification-daemon Autostart automatisch eingerichtet**
  - Startet notification-daemon sofort nach Installation
  - Funktioniert nach Neustart automatisch
  - Informative Meldungen fÃ¼r Benutzer

- `uninstall.sh`:
  - Entfernt notification-daemon Autostart-Datei
  - Optional: Deinstalliert libnotify-bin und notification-daemon
  - Stoppt laufende notification-daemon Prozesse

- `README.md`:
  - Version Badge 1.0.4
  - Desktop-Benachrichtigungen Feature-Sektion
  - Installation/Deinstallation Hinweise aktualisiert

- `CHANGELOG.md`:
  - v1.0.4 EintrÃ¤ge hinzugefÃ¼gt
  - notification-daemon Autostart dokumentiert

### Neue Dateien
- `releases/v1.0.4.md` - Diese Release Notes

## ğŸ“¦ Installation & Update

### Neue Installation
```bash
git clone https://github.com/roimme65/raspbian-updater.git
cd raspbian-updater
sudo ./install.sh
```

Das install.sh Script installiert jetzt automatisch:
- âœ… libnotify-bin (notify-send Kommando)
- âœ… notification-daemon (Desktop-Benachrichtigungs-Service)
- âœ… **notification-daemon Autostart** (startet automatisch nach Neustart)
- âœ… Alle bestehenden Komponenten

### Update von v1.0.3
```bash
cd raspbian-updater
git pull origin main

# Optional: Benachrichtigungs-Tools nachinstallieren
sudo apt-get install -y libnotify-bin notification-daemon
```

### Deinstallation
```bash
cd raspbian-updater
sudo ./uninstall.sh
```

## ğŸ§ª Testen der Desktop-Benachrichtigungen

### Manueller Test
```bash
# Test-Benachrichtigung senden
notify-send "Test" "Funktioniert die Benachrichtigung?"

# Auto-Updater im Dry-Run testen
sudo raspbian-autoupdater --dry-run
# â†’ Sie sollten eine "Keine Updates" Benachrichtigung sehen
```

### Cronjob-Test
```bash
# FÃ¼ge Testjob hinzu
echo "*/5 * * * * /usr/local/bin/raspbian-autoupdater" | sudo crontab -

# Warte 5 Minuten, Benachrichtigung sollte erscheinen
# (funktioniert nur wenn GUI-Session aktiv)
```

## ğŸ¯ Use Cases

### Desktop-Benutzer
- âœ… Sichtbare Benachrichtigungen bei manueller oder automatischer AusfÃ¼hrung
- âœ… Kritische Warnungen bei erforderlichem Neustart
- âœ… Feedback auch bei Cronjob-Updates

### Headless-Server
- âœ… Script lÃ¤uft normal auch ohne Desktop-Umgebung
- âœ… Benachrichtigungen werden Ã¼bersprungen (keine Fehler)
- âœ… Alle Log-Funktionen bleiben erhalten

### Hybrid (Desktop + SSH)
- âœ… Benachrichtigungen in GUI-Session
- âœ… Log-Dateien fÃ¼r SSH-Zugriff
- âœ… JSON-Status fÃ¼r Automatisierung

## ğŸ› Bekannte Probleme

### ~~notification-daemon muss laufen~~ âœ… BEHOBEN in v1.0.4
- ~~**Problem:** Benachrichtigungen erscheinen nur wenn notification-daemon aktiv ist~~
- ~~**Problem:** notification-daemon startet nicht automatisch nach Neustart~~
- **âœ… LÃ¶sung:** Autostart-Datei wird automatisch von install.sh erstellt
- **âœ… Status:** Funktioniert jetzt automatisch nach jedem Neustart

### Benachrichtigungen in Wayland
- **Problem:** notify-send funktioniert mÃ¶glicherweise nicht unter reinem Wayland
- **LÃ¶sung:** Raspberry Pi OS Trixie nutzt X11-KompatibilitÃ¤tsschicht
- **Status:** Funktioniert auf Raspberry Pi OS Desktop

## ğŸ™ Danksagungen

Danke an alle, die Feedback zur Benutzerfreundlichkeit gegeben haben!

## ğŸ“Š Statistik

- **Commits:** 3
- **GeÃ¤nderte Dateien:** 4
- **Neue Zeilen:** ~120
- **GelÃ¶schte Zeilen:** ~40
- **Neue Features:** 1 (Desktop-Benachrichtigungen)
- **Bug-Fixes:** 1 (apt/dpkg Fortschrittsanzeigen)

---

**VollstÃ¤ndiger Changelog:** [CHANGELOG.md](../CHANGELOG.md)  
**Download:** [v1.0.4](https://github.com/roimme65/raspbian-updater/releases/tag/v1.0.4)
